const e=e=>Object.is(e,-0)?"-0":e,t={"+":{func:(t,n)=>`${e(Number(t)+Number(n))}`,precedence:1,associativity:"left",arity:2},"-":{func:(t,n)=>`${e(Number(t)-Number(n))}`,precedence:1,associativity:"left",arity:2},"*":{func:(t,n)=>`${e(Number(t)*Number(n))}`,precedence:2,associativity:"left",arity:2},"/":{func:(t,n)=>`${e(Number(t)/Number(n))}`,precedence:2,associativity:"left",arity:2},"%":{func:(t,n)=>`${e(Number(t)%Number(n))}`,precedence:2,associativity:"left",arity:2},"^":{func:(t,n)=>`${e(Math.pow(Number(t),Number(n)))}`,precedence:3,associativity:"right",arity:2}},n=Object.keys(t),r={min:{func:(t,n)=>`${e(Math.min(Number(t),Number(n)))}`,arity:2},max:{func:(t,n)=>`${e(Math.max(Number(t),Number(n)))}`,arity:2},sin:{func:t=>`${e(Math.sin(Number(t)))}`,arity:1},cos:{func:t=>`${e(Math.cos(Number(t)))}`,arity:1},tan:{func:t=>`${e(Math.tan(Number(t)))}`,arity:1},log:{func:e=>`${Math.log(Number(e))}`,arity:1}},o=Object.keys(r),s=e=>e[e.length-1];function i(e){const i=function(e){const t=e.replace(/\s+/g," "),r=[];let i="",c="";for(let a=0;a<t.length;a++){const e=t.charAt(a),u=t.charAt(a-1),l=t.charAt(a+1),f=s(r),p=""!==c;if(/\d/.test(e)||("+"===e||"-"===e)&&!p&&(void 0===f||","===f||"("===f||n.includes(f))&&/\d/.test(l))c+=e;else if("."===e){if(p&&c.includes("."))throw new Error(`Double '.' in number: '${c}${e}'`);c+=e}else if(" "===e){if(/\d/.test(u)&&/\d/.test(l))throw new Error(`Space in number: '${c}${e}${l}'`)}else if(o.includes(i+e))i+=e,o.includes(i+l)||(r.push(i),i="");else if(n.includes(e)||"("===e||")"===e||","===e){if(n.includes(e)&&!p&&n.includes(f))throw new Error(`Consecutive operators: '${f}${e}'`);p&&r.push(c),r.push(e),c=""}else i+=e}if(""!==i)throw new Error(`Invalid characters: '${i}'`);return""!==c&&r.push(c),"+"!==r[0]&&"-"!==r[0]||r.unshift("0"),r}(e),c=function(e){const n=new Array,o=new Array;for(const i of e)if(void 0!==r[i])o.push(i);else if(","===i){for(;o.length>0&&"("!==s(o);)n.push(o.pop());if(0===o.length)throw new Error("Misplaced ','")}else if(void 0!==t[i]){const e=i;for(;o.length>0&&void 0!==s(o)&&"("!==s(o)&&(t[s(o)].precedence>t[e].precedence||t[e].precedence===t[s(o)].precedence&&"left"===t[e].associativity);)n.push(o.pop());o.push(e)}else if("("===i)o.push(i);else if(")"===i){for(;o.length>0&&"("!==s(o);)n.push(o.pop());if(!(o.length>0&&"("===s(o)))throw new Error("Parentheses mismatch");o.pop(),void 0!==r[s(o)]&&n.push(o.pop())}else n.push(i);for(;o.length>0;){if("("===s(o))throw new Error("Parentheses mismatch");n.push(o.pop())}return n}(i);return function(e){const n=new Array,o={...t,...r};for(const t of e){const e=o[t];if(void 0!==e){const t=[];for(let r=0;r<e.arity;r++)t.push(n.pop());n.push(e.func(...t.reverse()))}else n.push(t)}if(n.length>1)throw new Error("Insufficient operators");return Number(n[0])}(c)}!function(){const e=["localhost:","safemode=","action=submit"].some(e=>window.location.href.includes(e));function t(e,t){let n;return function(...r){clearTimeout(n),n=setTimeout(()=>e.apply(this,r),t)}}document.querySelectorAll(".stat-display").forEach(n=>{const r=new Map,o=n.querySelectorAll(".stat-controls");if(0===o.length)return;e&&console.log("Controllers found: ",o);for(const e of o){const n=e.getAttribute("data-levels")?.split(",")?.map(e=>(e||"").trim())?.filter(e=>e&&""!==e);if(!n)return;const o=document.createElement("input");o.type="range",o.classList.add("stat-slider"),o.min="0",o.max=(n.length-1).toString(),o.value="0",e.appendChild(o);const s=document.createElement("input");s.type="text",s.classList.add("stat-input"),e.appendChild(s);const i=e.getAttribute("data-name")||"main",a=e=>{e=Math.max(0,Math.min(e,n.length-1)),r.set(i,e),o&&(o.value=e.toString()),s&&(s.value=n[e].toString())},u=(e,n=!1)=>{a(e),n?t(c,5)():c()};o.addEventListener("input",e=>{const t=e.currentTarget,n=parseInt(t.value);u(n,!1)}),s.addEventListener("change",e=>{const t=e.currentTarget.value.trim(),r=n.indexOf(t);u(-1!==r?r:parseInt(o.value))}),a(0)}const s=n.querySelectorAll(".stat-value");function c(){s.forEach(t=>function(t,n){const r=new Map;if(n.forEach((e,n)=>{for(const o of["","1","2","3","4","5"]){const s=`data-${n}${o}-values`,i=t.getAttribute(s);if(i){const t=i.split(",")[e]||"";r.set(n+o,t)}}}),e&&console.log("Parsed data: ",r),1!=r.size){if(r.size>1){let n=t.getAttribute("data-formula");if(!n)return;const o=Array.from(r.entries()),s=o.slice().sort(([e],[t])=>t.length-e.length);for(const[e,t]of s)n=n?.replaceAll(e,t);e&&(console.log("Entries",o),console.log("New formula",n));const c=parseInt(t.getAttribute("data-precision")||"0")||0,a=i(n).toFixed(c);return t.textContent=a.toString(),void(t.title=o.map(([e,t])=>`${e}: ${t}`).join("\n")+"\n"+n)}for(const[e,r]of n.entries()){const n=`data-${e}-children`,o=t.getAttribute(n);if(!o)continue;const s=o.split(",");let i=parseInt(s[r])||0;return i-=1,void Array.from(t.children).forEach((e,t)=>{e.style.display=t===i?"":"none"})}}else t.textContent=r.values().next().value}(t,r))}c()})}();
