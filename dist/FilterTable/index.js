mw.hook("wikipage.content").add(function(){const t=["localhost:","safemode=","action=submit"].some(t=>window.location.href.includes(t));if(!$(".filter-wrapper").length)return;const e=Object.freeze({CONTAINS:Symbol("contains"),EXACT:Symbol("exact")});$.getScript("https://cdn.jsdelivr.net/npm/datatables@1.10.18/media/js/jquery.dataTables.min.js",function(){$(".filter-wrapper").each((n,i)=>{const o=$(i),a=o.data("table-id"),c=$(document.getElementById(a));if(!c.length)return;let l;!function(t){if(0===t.find("thead").length){const e=t.find("tr").first(),n=$("<thead></thead>").append(e);t.prepend(n)}t.find("style").each(function(){$(this).appendTo("head")})}(c);try{l=c.DataTable({paging:!1,info:!1,searching:!0,dom:"t",autoWidth:!1,responsive:!1})}catch(s){return void mw.notify(`Error initializing DataTable on table with id ${a}.\nMessage: ${s.message}`,{autoHide:!1,type:"error",title:"FilterTable initialization failed."})}"citizen"===mw.config.get("skin")&&c.unwrap(".dataTables_wrapper"),function(e,n){const i=e.find(".filter-counter"),o=e.find(".filter-counter-total");i.length&&n.on("draw",function(){const e=n.page.info();t&&console.log(e),i.text(e.recordsDisplay),o.text(e.recordsTotal)})}(o,l);const r=function(t,e){const n=[];return t.find(".filter-search").each(function(){const t=$(this),i=$('<input type="text" placeholder="Type to search..." />');i.on("keyup input",function(){e.search(this.value).draw()}),t.append(i),n.push(i)}),n}(o,l);o.find(".filter-row").each(function(){!function(t,n){const i=parseInt(t.data("col"))-1;if(isNaN(i))return;const o=t.data("mode");let a;a="contains"===o?e.CONTAINS:e.EXACT;let c=[];const l=t.find(".filter-button.is-all"),r=t.find(".filter-button").not(".is-all");l.on("click",function(){c=[],t.find(".filter-button").removeClass("button-selected"),$(this).addClass("button-selected"),n.column(i).search("").draw()}),r.on("click",function(){const t=$(this),o=(t.attr("data-query")||t.text().trim()).replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=c.indexOf(o);if(r>-1?(c.splice(r,1),t.removeClass("button-selected")):(c.push(o),t.addClass("button-selected")),0===c.length)l.addClass("button-selected"),n.column(i).search("").draw();else{l.removeClass("button-selected");let t=c.join("|");a===e.EXACT&&(t="^("+t+")$"),n.column(i).search(t,!0,!1).draw()}}),l.trigger("click")}($(this),l)}),function(t,e){t.find(".filter-reset").on("click",function(){e.forEach(function(t){t.val("").trigger("input")}),t.find(".filter-row").each(function(){const t=$(this).find(".is-all");t.length?t.trigger("click"):$(this).find(".filter-button.button-selected").trigger("click")})})}(o,r)})})});
