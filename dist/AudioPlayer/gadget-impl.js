(function(mw){mw.loader.impl(function(){return ["ext.gadget.store.AudioPlayer@303075c5",function($,jQuery,require,module){(function(){function A(i,e){var o=document.createElement("script");o.setAttribute("src",i),o.onload=e,document.body.appendChild(o)}function y(i){let e=parseInt(i),o=Math.floor(e/60);e-=o*60;const s=Math.floor(o/60);return o-=s*60,s===0?`${o}:${String(e%60).padStart(2,0)}`:`${String(s).padStart(2,0)}:${o}:${String(e%60).padStart(2,0)}`}async function M(){if(!("mediaCapabilities"in navigator))return console.warn("MediaCapabilities API not supported"),!1;const i={type:"file",audio:{contentType:'audio/ogg; codecs="opus"',channels:2,bitrate:64e3,samplerate:44100}};try{return(await navigator.mediaCapabilities.decodingInfo(i)).powerEfficient}catch(e){return console.error("Error while checking media capabilities:",e),!1}}let k={mp3:!1,wav:!1,ogg:!1,flac:!0};const f={};function N(i){const e=i.search(/\.[a-zA-Z0-9]+$/i);if(e===-1)return i;const o=i.substring(e+1).toLowerCase();return k[o]===!1?i:i.replace(/wikitide\.net\/([^/]+)\/(.)\/(..)\/(\w+)\.ogg/i,"wikitide.net/$1/transcoded/$2/$3/$4.ogg/$4.ogg.mp3")}function O(i,e){const o=e.dataset,s=o.group,m=o.loop==="true",W=o.preload!=="false",j=parseFloat(o.loopStart),l=parseFloat(o.loopEnd),L=o.pauseButton,E=o.filename,r=e.querySelector(".toggle-play"),g=e.querySelector(".progress"),v=e.querySelector(".timeline");let u=parseFloat(o.volume);isNaN(u)&&(u=1);const T=e.querySelector(".volume-button"),d=e.querySelector(".volume"),S=e.querySelector(".volume-slider"),q=e.querySelector(".volume-percentage"),D=e.querySelector(".time"),a=e.querySelector(".current"),G=e.querySelector(".divider"),U=e.querySelector(".length");if(L&&L==="true"){r.parentElement.addEventListener("click",function(){f[s].pause()});return}let p=!1;function b(){r.classList.remove("pause"),r.classList.add("play")}function x(){t.state()==="unloaded"&&t.load()}function C(n){q&&(q.style.width=n*100+"%")}const t=new Howl({src:[N(o.src)],preload:W,onpause:b,onplay:function(){r.classList.remove("play"),r.classList.add("pause"),m&&l!==0&&setTimeout(B,20),(m&&l!==0||g||a)&&setTimeout(h,100)},onend:function(){m?(t.seek(0),t.play()):b()},onload:function(){D&&(a.innerText="0:00",G.innerText="/",U.innerText=y(t.duration()))},onloaderror:function(n){a&&(a.innerText="Failed to load"),console.log(n)},onvolume:function(){C(t.volume())}});C(u),t.volume(u);function B(){const n=t.seek();n>=l&&n-l<.5&&t.seek(j),t.playing&&setTimeout(B,20)}function h(){const n=t.seek();g&&(g.style.width=n/t.duration()*100+"%"),a&&(a.innerText=y(n)),t.playing&&setTimeout(h,20)}t.on("seek",h);function F(){if(E){const n="/wiki/File:"+E;return window.open(n,"_blank").focus(),!0}return!1}r.parentElement.addEventListener("contextmenu",function(n){return n.preventDefault(),!F()}),r.parentElement.addEventListener("click",function(n){if(!(n.ctrlKey&&F()))if(x(),t.playing())t.pause();else{if(s&&s!=="concurrent"){const c=f[s];c&&c.pause(),f[s]=t}t.play()}}),v&&v.addEventListener("click",n=>{x();const c=window.getComputedStyle(v).width,w=n.offsetX/parseInt(c)*t.duration();t.seek(w)});function I(){p?(t.mute(!1),d.classList.remove("icon-muted"),d.classList.add("icon-volume-medium")):(t.mute(!0),d.classList.add("icon-muted"),d.classList.remove("icon-volume-medium")),p=!p}T&&T.addEventListener("click",I),S&&S.addEventListener("click",n=>{p&&I();const c=window.getComputedStyle(S).width,w=n.offsetX/parseInt(c);t.volume(w)})}async function V(){await M()||(k.ogg=!0),$(".audio-player").each(O)}A("https://cdn.jsdelivr.net/npm/howler@2.2.4/dist/howler.min.js",V)})();},{"css":[]},{},{},null];});})(mediaWiki);