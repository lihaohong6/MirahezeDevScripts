(function(A){A.loader.impl(function(){return["ext.gadget.store.AudioPlayer@6809e3e6",function(j,K,O,Q){(function(){function M(i,e){var n=document.createElement("script");n.setAttribute("src",i),n.onload=e,document.body.appendChild(n)}function h(i){let e=parseInt(i),n=Math.floor(e/60);e-=n*60;const r=Math.floor(n/60);return n-=r*60,r===0?`${n}:${String(e%60).padStart(2,0)}`:`${String(r).padStart(2,0)}:${n}:${String(e%60).padStart(2,0)}`}async function N(){if(!("mediaCapabilities"in navigator))return console.warn("MediaCapabilities API not supported"),!1;const i={type:"file",audio:{contentType:'audio/ogg; codecs="opus"',channels:2,bitrate:64e3,samplerate:44100}};try{return(await navigator.mediaCapabilities.decodingInfo(i)).powerEfficient}catch(e){return console.error("Error while checking media capabilities:",e),!1}}let k={mp3:!1,wav:!1,ogg:!1,flac:!0};const m={};function B(i){const e=i.search(/\.[a-zA-Z0-9]+$/i);if(e===-1)return i;const n=i.substring(e+1).toLowerCase();return k[n]===!1?i:i.replace(/wikitide\.net\/([^/]+)\/(.)\/(..)\/(\w+)\.ogg/i,"wikitide.net/$1/transcoded/$2/$3/$4.ogg/$4.ogg.mp3")}function D(i,e){const n=e.dataset,r=n.group,f=n.loop==="true",W=n.preload!=="false",X=parseFloat(n.loopStart),l=parseFloat(n.loopEnd),L=n.pauseButton,E=n.filename,a=e.querySelector(".toggle-play"),g=e.querySelector(".progress"),y=e.querySelector(".timeline");let u=parseFloat(n.volume);isNaN(u)&&(u=1);const q=e.querySelector(".volume-button"),d=e.querySelector(".volume"),v=e.querySelector(".volume-slider"),b=e.querySelector(".volume-percentage"),z=e.querySelector(".time"),s=e.querySelector(".current"),G=e.querySelector(".divider"),H=e.querySelector(".length");if(L&&L==="true"){a.parentElement.addEventListener("click",function(){m[r].pause()});return}let p=!1;function T(){a.classList.remove("pause"),a.classList.add("play")}function $(){t.state()==="unloaded"&&t.load()}function x(o){b&&(b.style.width=o*100+"%")}const t=new Howl({src:[B(n.src)],preload:W,onpause:T,onplay:function(){a.classList.remove("play"),a.classList.add("pause"),f&&l!==0&&setTimeout(C,20),(f&&l!==0||g||s)&&setTimeout(w,100)},onend:function(){f?(t.seek(0),t.play()):T()},onload:function(){z&&(s.innerText="0:00",G.innerText="/",H.innerText=h(t.duration()))},onloaderror:function(o){s&&(s.innerText="Failed to load"),console.log(o)},onvolume:function(){x(t.volume())}});x(u),t.volume(u);function C(){const o=t.seek();o>=l&&o-l<.5&&t.seek(X),t.playing&&setTimeout(C,20)}function w(){const o=t.seek();g&&(g.style.width=o/t.duration()*100+"%"),s&&(s.innerText=h(o)),t.playing&&setTimeout(w,20)}t.on("seek",w);function F(){if(E){const o="/wiki/File:"+E;return window.open(o,"_blank").focus(),!0}return!1}a.parentElement.addEventListener("contextmenu",function(o){return o.preventDefault(),!F()}),a.parentElement.addEventListener("click",function(o){if(!(o.ctrlKey&&F()))if($(),t.playing())t.pause();else{if(r&&r!=="concurrent"){const c=m[r];c&&c.pause(),m[r]=t}t.play()}}),y&&y.addEventListener("click",o=>{$();const c=window.getComputedStyle(y).width,S=o.offsetX/parseInt(c)*t.duration();t.seek(S)});function I(){p?(t.mute(!1),d.classList.remove("icon-muted"),d.classList.add("icon-volume-medium")):(t.mute(!0),d.classList.add("icon-muted"),d.classList.remove("icon-volume-medium")),p=!p}q&&q.addEventListener("click",I),v&&v.addEventListener("click",o=>{p&&I();const c=window.getComputedStyle(v).width,S=o.offsetX/parseInt(c);t.volume(S)})}async function P(){await N()||(k.ogg=!0),j(".audio-player").each(D)}M("https://cdn.jsdelivr.net/npm/howler@2.2.4/dist/howler.min.js",P)})()},{css:[]},{},{},null]})})(mediaWiki);
